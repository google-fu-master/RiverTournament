---
layout: default
title: River Tournament
---

<h1 id="tournament-date" style="text-align: center; font-size: 2rem; margin: 1rem 0;">Loading Bracket...</h1>

<div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 2rem;">
  <div style="flex: 1; min-width: 300px; max-width: 500px;">
    <h2 style="text-align: center;">Bracket</h2>
    <ul id="bracket" style="list-style: none; padding: 0; margin: 0; background-color: var(--slate); border-radius: 4px;"></ul>
  </div>
  <div style="flex: 1; min-width: 300px; max-width: 500px;">
    <h2 style="text-align: center;">Waitlist</h2>
    <ul id="waitlist" style="list-style: none; padding: 0; margin: 0; background-color: var(--slate); border-radius: 4px;"></ul>
  </div>
</div>

<script>
  // Calculate this week's tournament date based on 7:31pm Thursday cutoff
  function getTournamentDate() {
    const now = new Date();
    const cutoffHour = 19;
    const cutoffMinute = 31;
    const dayOfWeek = now.getDay();
    const daysUntilThursday = (4 - dayOfWeek + 7) % 7 || 7;
    const thisThursday = new Date(now.getFullYear(), now.getMonth(), now.getDate() + daysUntilThursday - (dayOfWeek <= 4 ? 0 : 7));
    thisThursday.setHours(cutoffHour);
    thisThursday.setMinutes(cutoffMinute);
    thisThursday.setSeconds(0);

    let tournamentDate;
    if (now < thisThursday) {
      const tournamentThisThursday = new Date(now.getFullYear(), now.getMonth(), now.getDate() + (4 - dayOfWeek));
      tournamentDate = tournamentThisThursday;
    } else {
      const tournamentNextThursday = new Date(now.getFullYear(), now.getMonth(), now.getDate() + ((4 - dayOfWeek + 7) % 7 || 7));
      tournamentDate = tournamentNextThursday;
    }
    const options = { month: 'short', day: 'numeric' };
    document.getElementById('tournament-date').textContent = `${tournamentDate.toLocaleDateString('en-US', options)} Bracket`;
    return tournamentDate.toISOString().split('T')[0];
  }

  const tournamentDate = getTournamentDate();

  // Fetch and filter data
  fetch('https://docs.google.com/spreadsheets/d/e/2PACX-1vT5ck-1B7HvfNdb83vap3DeZJNT4PBWdLeNoGIm5WM7BbxVw-8nIa0VAVEfo3iv3G5Zs8W5vHt-Wjnr/pub?output=csv')
    .then(response => response.text())
    .then(data => {
      const rows = data.trim().split('\n').slice(1).map(row => row.split(','));
      const bracketList = document.getElementById('bracket');
      const waitlistList = document.getElementById('waitlist');

      let bracketCount = 0;
      let waitlistCount = 0;

      rows.forEach(row => {
        const [signUpTime, firstName, lastName, , , , , newPlayer, tournamentDateField, approved] = row.map(cell => cell.trim());
        if (tournamentDateField !== tournamentDate) return;

        const lastInitial = lastName ? lastName.charAt(0) + '.' : '';
        const displayName = `${firstName} ${lastInitial}`;

        const li = document.createElement('li');
        li.textContent = displayName;
        li.style.padding = '0.5rem';

        if (approved === 'TRUE' && bracketCount < 16) {
          bracketList.appendChild(li);
          bracketCount++;
        } else if (approved !== 'TRUE' && waitlistCount < 16) {
          waitlistList.appendChild(li);
          waitlistCount++;
        }
      });
    })
    .catch(error => console.error('Error fetching data:', error));
</script>
